name: Smart Itinerary Production Deployment

# TODO setup later:
# env:
#     VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
#     VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

on:
    push:
        branches:
            - main
    pull_request:
        branches:
            - main

jobs:
    Build:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4
  
        - uses: actions/setup-node@v4
          with:
            node-version: 20.x
  
        - run: npm ci
  
        - run: npm run build

    Test:
        runs-on: ubuntu-latest
        steps:

            - uses: actions/checkout@v4

            - uses: actions/setup-node@v4
              with:
                node-version: 20.x

            - run: npm ci

            - run: npm run test:prod
            
    # TODO add SAST code scan:
    # SAST:

    # TODO setup later if using vercel:
    # Deploy-Production:
    #     needs: [Test]
    #     runs-on: ubuntu-latest
    #     steps:

    #         - uses:  actions/checkout@v4

    #         - name: Install Vercel CLI
    #           run: npm install --global vercel

    #         - name: Pull Vercel Environment Information
    #           run: vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}

    #         - name: Build Project Artifacts
    #           run: vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}

    #         - name: Deploy Project Artifacts
    #           run: vercel deploy --prebuilt --prod --token=${{ secrets.VERCEL_TOKEN }}